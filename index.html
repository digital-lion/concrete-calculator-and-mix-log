<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concrete Mix Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --muted-green: #7d8471;
            --muted-blue: #6b7d8a;
            --terracotta: #c17a5b;
            --black: #1a1a1a;
            --white: #ffffff;
            --light-gray: #f8faf9;
            --border-light: #e8ede9;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 12px;
            background: linear-gradient(135deg, #f8faf9 0%, #e8ede9 100%);
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
        }
        
        .container {
            background: var(--white);
            border-radius: 0;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            margin-bottom: 24px;
            border: 1px solid var(--border-light);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 16px;
                margin-bottom: 12px;
            }
        }
        
        h1 {
            color: var(--black);
            font-weight: 600;
            font-size: 28px;
            margin-bottom: 32px;
            position: relative;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
                text-align: center;
            }
        }
        
        h2 {
            color: var(--muted-green);
            font-weight: 500;
            font-size: 20px;
            margin-top: 0;
            margin-bottom: 20px;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
            align-items: start;
        }
        
        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
                gap: 16px;
                margin-bottom: 16px;
            }
        }
        
        .input-section, .output-section {
            background: var(--light-gray);
            padding: 24px;
            border-radius: 0;
            border: 1px solid var(--border-light);
        }
        
        .output-section {
            display: flex;
            flex-direction: column;
            height: fit-content;
            min-height: 100%;
        }
        
        @media (max-width: 768px) {
            .input-section, .output-section {
                padding: 16px;
            }
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .first-row-inputs {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .first-row-inputs {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .first-row-inputs {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
        
        .first-row-inputs input {
            width: 100% !important;
            margin: 3px 0 !important;
            box-sizing: border-box;
        }
        
        .first-row-inputs label {
            font-size: 12px;
            color: var(--black);
            margin-bottom: 4px;
        }
        
        .output-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        label {
            display: block;
            font-weight: 500;
            color: var(--black);
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        input[type="number"], select {
            width: 80px !important;
            padding: 12px 16px;
            border: 2px solid var(--border-light);
            border-radius: 0;
            font-size: 14px;
            transition: all 0.2s ease;
            background: var(--white);
            margin: 3px 10px 3px 0 !important;
        }
        
        @media (max-width: 768px) {
            input[type="number"], select {
                width: calc(100% - 24px) !important;
                margin: 3px 0 !important;
                padding: 10px 12px;
                font-size: 16px;
                box-sizing: border-box;
            }
        }
        
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--muted-green);
            box-shadow: 0 0 0 3px rgba(125, 132, 113, 0.1);
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--muted-green);
            margin-right: 8px;
        }
        
        .pigment-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }
        
        @media (max-width: 768px) {
            .pigment-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .pigment-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }
        }
        
        .pigment-grid input {
            width: 100%;
            padding: 8px 6px;
            font-size: 12px;
            margin: 2px 0;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .pigment-grid input {
                padding: 10px 12px;
                font-size: 16px;
            }
        }
        
        .pigment-grid label {
            font-size: 12px;
            margin-bottom: 4px;
        }
        
        .density-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        
        @media (max-width: 480px) {
            .density-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
        
        .plasticizer-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 480px) {
            .plasticizer-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
        
        .plasticizer-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .plasticizer-input input {
            width: 80px;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .plasticizer-input input {
                width: 100px;
            }
        }
        
        .output-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--white);
            border-radius: 0;
            margin-bottom: 8px;
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }
        
        .output-item:hover {
            box-shadow: 0 2px 8px rgba(125, 132, 113, 0.1);
            border-color: var(--muted-green);
        }
        
        .output-value {
            font-weight: 600;
            color: var(--muted-green);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .button {
            background: linear-gradient(135deg, var(--muted-green) 0%, #8b9a7d 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 0;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 2px;
            box-shadow: 0 2px 8px rgba(125, 132, 113, 0.2);
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(125, 132, 113, 0.3);
        }
        
        .hamburger-menu {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--muted-green);
            color: white;
            border: none;
            padding: 12px;
            cursor: pointer;
            font-size: 18px;
        }
        
        @media (max-width: 768px) {
            .hamburger-menu {
                display: block;
            }
        }
        
        .save-controls {
            background: var(--white);
            padding: 16px;
            border-radius: 0;
            border: 1px solid var(--border-light);
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(26, 26, 26, 0.04);
        }
        
        @media (max-width: 768px) {
            .save-controls {
                position: fixed;
                top: 0;
                right: -350px;
                width: 320px;
                height: 100vh;
                background: var(--white);
                box-shadow: -4px 0 12px rgba(0,0,0,0.15);
                z-index: 999;
                transition: right 0.3s ease;
                overflow-y: auto;
                padding: 20px;
                margin: 0;
            }
            
            .save-controls.mobile-open {
                right: 0;
            }
        }
        
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 998;
        }
        
        .mobile-overlay.active {
            display: block;
        }
        
        .mobile-close-btn {
            display: none;
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--black);
            padding: 5px;
        }
        
        @media (max-width: 768px) {
            .mobile-close-btn {
                display: block;
            }
        }
        
        .controls-title-compact {
            font-size: 16px;
            font-weight: 600;
            color: var(--black);
            margin: 0 0 12px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }
        
        @media (max-width: 768px) {
            .controls-title-compact {
                cursor: default;
                margin-top: 20px;
            }
        }
        
        .dropdown-arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
        }
        
        .dropdown-arrow.expanded {
            transform: rotate(180deg);
        }
        
        @media (max-width: 768px) {
            .dropdown-arrow {
                display: none;
            }
        }
        
        .button-sections {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 16px;
            align-items: start;
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease, padding 0.3s ease;
            padding: 0;
        }
        
        @media (max-width: 768px) {
            .button-sections {
                grid-template-columns: 1fr;
                gap: 12px;
                max-height: none !important;
                overflow: visible !important;
                padding: 12px 0 !important;
            }
        }
        
        .button-sections.expanded {
            max-height: 200px;
            padding-top: 12px;
        }
        
        .button-section {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .section-label {
            font-size: 11px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .button-group-compact {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        
        @media (max-width: 768px) {
            .button-group-compact {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
        
        .button-group-single {
            display: flex;
        }
        
        .btn-compact {
            padding: 8px 12px;
            border: none;
            border-radius: 0;
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            white-space: nowrap;
        }
        
        @media (max-width: 768px) {
            .btn-compact {
                padding: 12px 16px;
                font-size: 12px;
                white-space: normal;
                text-align: center;
            }
        }
        
        .btn-compact-blue {
            background: linear-gradient(135deg, var(--muted-blue) 0%, #7a8b98 100%);
            color: white;
        }
        
        .btn-compact-green {
            background: linear-gradient(135deg, var(--muted-green) 0%, #8b9a7d 100%);
            color: white;
        }
        
        .btn-compact-danger {
            background: linear-gradient(135deg, var(--terracotta) 0%, #d18b6c 100%);
            color: white;
        }
        
        .alert {
            background: linear-gradient(135deg, #fff5f0 0%, #ffe8dc 100%);
            border: 1px solid var(--terracotta);
            border-radius: 0;
            padding: 12px 16px;
            margin: 16px 0;
            color: #bf360c;
            font-weight: 500;
        }
        
        .success-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border: 1px solid var(--muted-green);
            color: #2e7d32;
            padding: 6px 8px;
            border-radius: 0;
            margin: 4px 0;
            display: none;
            font-size: 10px;
        }
        
        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border: 1px solid var(--terracotta);
            color: #c62828;
            padding: 6px 8px;
            border-radius: 0;
            margin: 4px 0;
            display: none;
            font-size: 10px;
        }
        
        .log-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 12px;
        }
        
        .log-table th, .log-table td {
            border: 1px solid #dee2e6;
            padding: 6px;
            text-align: center;
            vertical-align: top;
        }
        
        .log-table th {
            background: linear-gradient(135deg, var(--muted-green) 0%, #8b9a7d 100%);
            color: white;
            font-weight: 500;
            font-size: 13px;
            position: relative;
        }
        
        .log-table .parameter-cell {
            background: var(--light-gray);
            font-weight: 500;
            text-align: right;
            width: 200px;
            position: sticky;
            left: 0;
            z-index: 1;
            color: var(--black);
            border-right: 2px solid var(--muted-green);
            padding-right: 12px;
        }
        
        .log-table tbody tr:nth-child(odd) {
            background-color: var(--white);
        }
        
        .log-table tbody tr:nth-child(even) {
            background-color: var(--light-gray);
        }
        
        .log-table tbody tr:nth-child(odd) .parameter-cell {
            background-color: var(--light-gray);
        }
        
        .log-table tbody tr:nth-child(even) .parameter-cell {
            background-color: var(--light-gray);
        }
        
        .log-table input[type="text"], .log-table input[type="number"], .log-table input[type="date"], .log-table select {
            width: 100%;
            border: none;
            background: transparent;
            padding: 4px;
            font-size: 11px;
            text-align: center;
            margin: 2px;
        }
        
        .log-table input[type="checkbox"] {
            transform: scale(1.2);
            margin: 2px;
        }
        
        .delete-column-btn {
            background: var(--terracotta);
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 0;
            font-size: 10px;
            cursor: pointer;
            margin-left: 5px;
        }
        
        .delete-column-btn:hover {
            background: #bf360c;
        }
        
        .table-container {
            overflow-x: auto;
            max-width: 100%;
        }
        
        @media (max-width: 768px) {
            .table-container {
                font-size: 11px;
            }
            
            .log-table {
                font-size: 10px;
                min-width: 600px;
            }
            
            .log-table th, .log-table td {
                padding: 4px;
            }
            
            .log-table .parameter-cell {
                width: 100px;
                font-size: 9px;
                padding-right: 6px;
            }
            
            .log-table input[type="text"], 
            .log-table input[type="number"], 
            .log-table input[type="date"],
            .log-table select {
                font-size: 10px;
                padding: 2px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Concrete Calculator & Mix Log</h1>
        
        <!-- Hamburger Menu Button (Mobile Only) -->
        <button class="hamburger-menu" onclick="toggleMobileMenu()">☰</button>
        
        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>
        
        <!-- Save/Load Controls -->
        <div class="save-controls" id="saveControls">
            <!-- Mobile Close Button -->
            <button class="mobile-close-btn" onclick="closeMobileMenu()">×</button>
            
            <h3 class="controls-title-compact" onclick="toggleDropdown()">
                Save & Load Data
                <span class="dropdown-arrow">▼</span>
            </h3>
            <div class="button-sections" id="buttonSections">
                <div class="button-section">
                    <div class="section-label">Local</div>
                    <div class="button-group-compact">
                        <button class="btn-compact btn-compact-blue" onclick="saveData()">Save Local</button>
                        <button class="btn-compact btn-compact-blue" onclick="document.getElementById('fileInput').click()">Load Local</button>
                        <button class="btn-compact btn-compact-blue" onclick="exportData()">Export JSON</button>
                        <button class="btn-compact btn-compact-blue" onclick="exportCSV()">Export CSV</button>
                    </div>
                </div>
                
                <div class="button-section">
                    <div class="section-label">Google Drive</div>
                    <div class="button-group-compact">
                        <button class="btn-compact btn-compact-green" onclick="initGoogleDrive()" id="authButton">Connect to Drive</button>
                        <button class="btn-compact btn-compact-green" onclick="saveToGoogleDrive()" id="saveToGDrive" style="display:none;">Save to Drive</button>
                        <button class="btn-compact btn-compact-green" onclick="loadFromGoogleDrive()" id="loadFromGDrive" style="display:none;">Load from Drive</button>
                        <button class="btn-compact btn-compact-green" onclick="signOutGoogleDrive()" id="signOutButton" style="display:none;">Sign Out</button>
                    </div>
                </div>
                
                <div class="button-section">
                    <div class="section-label">Reset</div>
                    <div class="button-group-single">
                        <button class="btn-compact btn-compact-danger" onclick="clearAllData()">Clear All Data</button>
                    </div>
                </div>
            </div>
            <div id="driveStatus" style="font-size: 11px; color: #666; margin-top: 5px;"></div>
            <input type="file" id="fileInput" accept=".json" onchange="loadData(event)" style="display: none;">
            <div class="success-message" id="successMessage"></div>
            <div class="error-message" id="errorMessage"></div>
        </div>
        
        <div class="calculator-grid">
            <div class="input-section">
                <h2>Input Parameters</h2>
                
                <div class="input-group">
                    <label>Mix Ratio (Portland : Sand)</label>
                    <div class="first-row-inputs">
                        <div>
                            <label for="ratioPortland">Portland</label>
                            <input type="number" id="ratioPortland" step="0.1" value="1" oninput="calculate()">
                        </div>
                        <div>
                            <label for="ratioSand">Sand</label>
                            <input type="number" id="ratioSand" step="0.1" value="3" oninput="calculate()">
                        </div>
                        <div>
                            <label for="volume">Mold Volume (in³)</label>
                            <input type="number" id="volume" step="0.1" value="10" oninput="calculate()">
                        </div>
                        <div>
                            <label for="waste">Waste Factor (%)</label>
                            <input type="number" id="waste" step="1" value="10" min="0" max="50" oninput="calculate()">
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Material Densities (g/cm³)</label>
                    <div class="density-grid">
                        <div>
                            <label for="densityCement">Cement</label>
                            <input type="number" id="densityCement" step="0.001" value="1.1" oninput="calculate()">
                        </div>
                        <div>
                            <label for="densitySand">Sand</label>
                            <input type="number" id="densitySand" step="0.001" value="1.72" oninput="calculate()">
                        </div>
                        <div>
                            <label for="densityWater">Water</label>
                            <input type="number" id="densityWater" step="0.001" value="1.0" oninput="calculate()">
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Pigment Percentages (% of cement weight)</label>
                    <div class="pigment-grid">
                        <div>
                            <label for="pigmentBlack">Black %</label>
                            <input type="number" id="pigmentBlack" step="0.1" value="0" min="0" max="10" oninput="calculate()">
                        </div>
                        <div>
                            <label for="pigmentBlue">Blue %</label>
                            <input type="number" id="pigmentBlue" step="0.1" value="0" min="0" max="10" oninput="calculate()">
                        </div>
                        <div>
                            <label for="pigmentGreen">Green %</label>
                            <input type="number" id="pigmentGreen" step="0.1" value="0" min="0" max="10" oninput="calculate()">
                        </div>
                        <div>
                            <label for="pigmentOrange">Orange %</label>
                            <input type="number" id="pigmentOrange" step="0.1" value="0" min="0" max="10" oninput="calculate()">
                        </div>
                        <div>
                            <label for="pigmentBrown">Brown %</label>
                            <input type="number" id="pigmentBrown" step="0.1" value="0" min="0" max="10" oninput="calculate()">
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Plasticizer</label>
                    <div class="plasticizer-controls">
                        <input type="checkbox" id="plasticizerEnabled" onchange="togglePlasticizer()" checked>
                        <div class="plasticizer-input" id="plasticizerInputs">
                            <input type="number" id="plasticizerPercent" step="0.01" value="0.21" min="0" max="5" oninput="calculate()">
                            <span>% of cement weight</span>
                        </div>
                    </div>
                </div>
                
                <div class="alert" id="pigmentAlert" style="display: none;">
                    ⚠️ Total pigment exceeds 10% of cement weight
                </div>
            </div>
            
            <div class="output-section">
                <h2>Calculated Amounts (grams)</h2>
                
                <div class="output-content">
                    <div>
                        <div class="output-item">
                            <span>Cement:</span>
                            <span class="output-value" id="outputCement">0 g</span>
                        </div>
                        <div class="output-item">
                            <span>Sand:</span>
                            <span class="output-value" id="outputSand">0 g</span>
                        </div>
                        <div class="output-item">
                            <span>Pigment Black:</span>
                            <span class="output-value" id="outputPigmentBlack">0 g</span>
                        </div>
                        <div class="output-item">
                            <span>Pigment Blue:</span>
                            <span class="output-value" id="outputPigmentBlue">0 g</span>
                        </div>
                        <div class="output-item">
                            <span>Pigment Green:</span>
                            <span class="output-value" id="outputPigmentGreen">0 g</span>
                        </div>
                        <div class="output-item">
                            <span>Pigment Orange:</span>
                            <span class="output-value" id="outputPigmentOrange">0 g</span>
                        </div>
                        <div class="output-item">
                            <span>Pigment Brown:</span>
                            <span class="output-value" id="outputPigmentBrown">0 g</span>
                        </div>
                        <div class="output-item">
                            <span>Plasticizer:</span>
                            <span class="output-value" id="outputPlasticizer">0 g</span>
                        </div>
                        <div class="output-item" style="border-top: 2px solid var(--muted-green); font-weight: bold;">
                            <span>Total Mix Weight:</span>
                            <span class="output-value" id="outputTotal">0 g</span>
                        </div>
                    </div>
                    
                    <button class="button" onclick="sendToLog()" style="width: 100%; margin-top: 20px; padding: 12px 24px; font-size: 14px;">📋 SEND TO LOG</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>Mix Log</h2>
        
        <div class="table-container">
            <table class="log-table" id="logTable">
                <thead>
                    <tr>
                        <th class="parameter-cell">Parameter</th>
                        <th>Mix #1 <button class="delete-column-btn" onclick="deleteColumn(1)">×</button></th>
                        <th>Mix #2 <button class="delete-column-btn" onclick="deleteColumn(2)">×</button></th>
                        <th>Mix #3 <button class="delete-column-btn" onclick="deleteColumn(3)">×</button></th>
                        <th>Mix #4 <button class="delete-column-btn" onclick="deleteColumn(4)">×</button></th>
                        <th>Mix #5 <button class="delete-column-btn" onclick="deleteColumn(5)">×</button></th>
                        <th>Mix #6 <button class="delete-column-btn" onclick="deleteColumn(6)">×</button></th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td class="parameter-cell">Cast Date</td><td><input type="date" onchange="updateDaysSinceCast(this, 1)"></td><td><input type="date" onchange="updateDaysSinceCast(this, 2)"></td><td><input type="date" onchange="updateDaysSinceCast(this, 3)"></td><td><input type="date" onchange="updateDaysSinceCast(this, 4)"></td><td><input type="date" onchange="updateDaysSinceCast(this, 5)"></td><td><input type="date" onchange="updateDaysSinceCast(this, 6)"></td></tr>
                    <tr><td class="parameter-cell">Days Since Cast</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Color</td><td><input type="text" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td></tr>
                    <tr><td class="parameter-cell">Ratio (P:S)</td><td><input type="text" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td></tr>
                    <tr><td class="parameter-cell">Adjusted Volume (in³)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">% Pigment Total</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Cement (g)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Sand (g)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Water (g)</td><td><input type="number"></td><td><input type="number"></td><td><input type="number"></td><td><input type="number"></td><td><input type="number"></td><td><input type="number"></td></tr>
                    <tr><td class="parameter-cell">Pigment Black (g)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Pigment Blue (g)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Pigment Green (g)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Pigment Orange (g)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Pigment Brown (g)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Plasticizer (g)</td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td><td><input type="number" readonly></td></tr>
                    <tr><td class="parameter-cell">Slurry Coat</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
                    <tr><td class="parameter-cell">Mold Release</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
                    <tr><td class="parameter-cell">Vibration</td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
                    <tr><td class="parameter-cell">Mix Notes</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
                    <tr><td class="parameter-cell">Bubble Rating (1-5)</td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td></tr>
                    <tr><td class="parameter-cell">Surface Quality</td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td></tr>
                    <tr><td class="parameter-cell">Color Evenness</td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td><td><select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></td></tr>
                    <tr><td class="parameter-cell">Sealer Used</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
                    <tr><td class="parameter-cell">Final Impressions</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Mobile menu functions
        function toggleMobileMenu() {
            const saveControls = document.getElementById('saveControls');
            const overlay = document.getElementById('mobileOverlay');
            
            saveControls.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }
        
        function closeMobileMenu() {
            const saveControls = document.getElementById('saveControls');
            const overlay = document.getElementById('mobileOverlay');
            
            saveControls.classList.remove('mobile-open');
            overlay.classList.remove('active');
        }
        
        // Desktop dropdown toggle function
        function toggleDropdown() {
            if (window.innerWidth > 768) {
                const sections = document.getElementById('buttonSections');
                const arrow = document.querySelector('.dropdown-arrow');
                
                sections.classList.toggle('expanded');
                arrow.classList.toggle('expanded');
            }
        }
        
        // Determine predominant pigment color
        function getPredominantColor() {
            const pigmentBlack = parseFloat(document.getElementById('pigmentBlack').value) || 0;
            const pigmentBlue = parseFloat(document.getElementById('pigmentBlue').value) || 0;
            const pigmentGreen = parseFloat(document.getElementById('pigmentGreen').value) || 0;
            const pigmentOrange = parseFloat(document.getElementById('pigmentOrange').value) || 0;
            const pigmentBrown = parseFloat(document.getElementById('pigmentBrown').value) || 0;
            
            const pigments = [
                { name: 'Black', value: pigmentBlack },
                { name: 'Blue', value: pigmentBlue },
                { name: 'Green', value: pigmentGreen },
                { name: 'Orange', value: pigmentOrange },
                { name: 'Brown', value: pigmentBrown }
            ];
            
            const maxPigment = pigments.reduce((max, pigment) => 
                pigment.value > max.value ? pigment : max
            );
            
            return maxPigment.value > 0 ? maxPigment.name : 'Natural';
        }
        
        // Calculate function
        function calculate() {
            // Get input values
            const volume = parseFloat(document.getElementById('volume').value) || 0;
            const ratioPortland = parseFloat(document.getElementById('ratioPortland').value) || 1;
            const ratioSand = parseFloat(document.getElementById('ratioSand').value) || 3;
            const wasteFactor = parseFloat(document.getElementById('waste').value) || 0;
            const plasticizerPercent = parseFloat(document.getElementById('plasticizerPercent').value) || 0.21;
            
            const pigmentBlack = parseFloat(document.getElementById('pigmentBlack').value) || 0;
            const pigmentBlue = parseFloat(document.getElementById('pigmentBlue').value) || 0;
            const pigmentGreen = parseFloat(document.getElementById('pigmentGreen').value) || 0;
            const pigmentOrange = parseFloat(document.getElementById('pigmentOrange').value) || 0;
            const pigmentBrown = parseFloat(document.getElementById('pigmentBrown').value) || 0;
            
            // Material densities
            const densityCement = parseFloat(document.getElementById('densityCement').value) || 1.1;
            const densitySand = parseFloat(document.getElementById('densitySand').value) || 1.72;
            
            // Convert cubic inches to cm³
            const volumeCm3 = volume * 16.387;
            
            // Apply waste factor
            const adjustedVolume = volumeCm3 * (1 + wasteFactor / 100);
            
            // Calculate total ratio parts
            const totalRatio = ratioPortland + ratioSand;
            
            // Calculate volume for each component
            const cementVolume = (ratioPortland / totalRatio) * adjustedVolume;
            const sandVolume = (ratioSand / totalRatio) * adjustedVolume;
            
            // Calculate weights
            const cementWeight = cementVolume * densityCement;
            const sandWeight = sandVolume * densitySand;
            
            // Calculate plasticizer weight (only if enabled)
            const plasticizerEnabled = document.getElementById('plasticizerEnabled').checked;
            const plasticizerWeight = plasticizerEnabled ? (plasticizerPercent / 100) * cementWeight : 0;
            
            // Calculate pigment weights (as percentage of cement weight)
            const pigmentBlackWeight = (pigmentBlack / 100) * cementWeight;
            const pigmentBlueWeight = (pigmentBlue / 100) * cementWeight;
            const pigmentGreenWeight = (pigmentGreen / 100) * cementWeight;
            const pigmentOrangeWeight = (pigmentOrange / 100) * cementWeight;
            const pigmentBrownWeight = (pigmentBrown / 100) * cementWeight;
            
            // Check total pigment percentage
            const totalPigmentPercent = pigmentBlack + pigmentBlue + pigmentGreen + pigmentOrange + pigmentBrown;
            const alertElement = document.getElementById('pigmentAlert');
            if (totalPigmentPercent > 10) {
                alertElement.style.display = 'block';
            } else {
                alertElement.style.display = 'none';
            }
            
            // Calculate total weight
            const totalWeight = cementWeight + sandWeight + plasticizerWeight +
                              pigmentBlackWeight + pigmentBlueWeight + pigmentGreenWeight + 
                              pigmentOrangeWeight + pigmentBrownWeight;
            
            // Update output displays
            document.getElementById('outputCement').textContent = Math.round(cementWeight * 10) / 10 + ' g';
            document.getElementById('outputSand').textContent = Math.round(sandWeight * 10) / 10 + ' g';
            document.getElementById('outputPlasticizer').textContent = Math.round(plasticizerWeight * 10) / 10 + ' g';
            document.getElementById('outputPigmentBlack').textContent = Math.round(pigmentBlackWeight * 10) / 10 + ' g';
            document.getElementById('outputPigmentBlue').textContent = Math.round(pigmentBlueWeight * 10) / 10 + ' g';
            document.getElementById('outputPigmentGreen').textContent = Math.round(pigmentGreenWeight * 10) / 10 + ' g';
            document.getElementById('outputPigmentOrange').textContent = Math.round(pigmentOrangeWeight * 10) / 10 + ' g';
            document.getElementById('outputPigmentBrown').textContent = Math.round(pigmentBrownWeight * 10) / 10 + ' g';
            document.getElementById('outputTotal').textContent = Math.round(totalWeight * 10) / 10 + ' g';
            
            // Auto-save after calculation
            autoSave();
        }
        
        function togglePlasticizer() {
            const enabled = document.getElementById('plasticizerEnabled').checked;
            const inputs = document.getElementById('plasticizerInputs');
            
            if (enabled) {
                inputs.style.display = 'flex';
            } else {
                inputs.style.display = 'none';
                document.getElementById('plasticizerPercent').value = '0';
            }
            calculate();
        }
        
        function updateDaysSinceCast(dateInput, mixNumber) {
            if (dateInput.value) {
                const castDate = new Date(dateInput.value);
                const today = new Date();
                const timeDiff = today.getTime() - castDate.getTime();
                const daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
                
                const tbody = document.getElementById('logTable').getElementsByTagName('tbody')[0];
                const daysSinceRow = tbody.getElementsByTagName('tr')[1];
                const daysSinceInput = daysSinceRow.getElementsByTagName('input')[mixNumber - 1];
                if (daysSinceInput) {
                    daysSinceInput.value = daysDiff >= 0 ? daysDiff : '';
                }
            }
            autoSave();
        }
        
        function addNewColumn() {
            const table = document.getElementById('logTable');
            const headerRow = table.getElementsByTagName('thead')[0].getElementsByTagName('tr')[0];
            const tbody = table.getElementsByTagName('tbody')[0];
            
            const mixNumber = headerRow.getElementsByTagName('th').length; // Current number including parameter column
            
            // Add header with delete button
            const newHeader = document.createElement('th');
            newHeader.innerHTML = `Mix #${mixNumber} <button class="delete-column-btn" onclick="deleteColumn(${mixNumber})">×</button>`;
            headerRow.appendChild(newHeader);
            
            // Add cells to all rows
            const rows = tbody.getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                const newCell = document.createElement('td');
                
                // Determine input type based on row
                if (i === 0) { // Cast Date
                    newCell.innerHTML = `<input type="date" onchange="updateDaysSinceCast(this, ${mixNumber})">`;
                } else if ([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13].includes(i)) { // Readonly calculated fields
                    newCell.innerHTML = '<input type="number" readonly>';
                } else if (i === 2) { // Color - readonly text
                    newCell.innerHTML = '<input type="text" readonly>';
                } else if ([14, 15, 16].includes(i)) { // Checkboxes (Slurry Coat, Mold Release, Vibration)
                    newCell.innerHTML = '<input type="checkbox">';
                } else if ([18, 19, 20].includes(i)) { // Dropdowns (Bubble Rating, Surface Quality, Color Evenness)
                    newCell.innerHTML = '<select><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>';
                } else { // Text fields
                    newCell.innerHTML = '<input type="text">';
                }
                
                rows[i].appendChild(newCell);
            }
        }
        
        function deleteColumn(columnIndex) {
            if (confirm(`Are you sure you want to delete Mix #${columnIndex}? This cannot be undone.`)) {
                const table = document.getElementById('logTable');
                const headerRow = table.getElementsByTagName('thead')[0].getElementsByTagName('tr')[0];
                const tbody = table.getElementsByTagName('tbody')[0];
                
                // Remove header column
                headerRow.deleteCell(columnIndex);
                
                // Remove cells from all rows
                const rows = tbody.getElementsByTagName('tr');
                for (let i = 0; i < rows.length; i++) {
                    rows[i].deleteCell(columnIndex);
                }
                
                // Renumber remaining headers and update delete buttons
                const headers = headerRow.getElementsByTagName('th');
                for (let i = 1; i < headers.length; i++) { // Start from 1 to skip parameter column
                    headers[i].innerHTML = `Mix #${i} <button class="delete-column-btn" onclick="deleteColumn(${i})">×</button>`;
                }
                
                // Update onchange handlers for date inputs
                const dateInputs = tbody.getElementsByTagName('tr')[0].getElementsByTagName('input');
                for (let i = 0; i < dateInputs.length; i++) {
                    dateInputs[i].setAttribute('onchange', `updateDaysSinceCast(this, ${i + 1})`);
                }
                
                showMessage('success', `Mix #${columnIndex} deleted successfully!`);
                autoSave();
            }
        }
        
        function sendToLog() {
            const table = document.getElementById('logTable');
            const tbody = table.getElementsByTagName('tbody')[0];
            const firstRow = tbody.getElementsByTagName('tr')[0]; // Cast Date row
            
            // Find the first empty column
            let columnIndex = -1;
            const inputs = firstRow.getElementsByTagName('input');
            for (let i = 0; i < inputs.length; i++) {
                if (!inputs[i].value) {
                    columnIndex = i;
                    break;
                }
            }
            
            // If no empty column found, add new column
            if (columnIndex === -1) {
                addNewColumn();
                columnIndex = inputs.length;
            }
            
            // Get current calculator values
            const volume = parseFloat(document.getElementById('volume').value) || 0;
            const wasteFactor = parseFloat(document.getElementById('waste').value) || 0;
            const adjustedVolumeInches = volume * (1 + wasteFactor / 100);
            
            const ratioPortland = parseFloat(document.getElementById('ratioPortland').value) || 1;
            const ratioSand = parseFloat(document.getElementById('ratioSand').value) || 3;
            const pigmentTotal = (parseFloat(document.getElementById('pigmentBlack').value) || 0) +
                               (parseFloat(document.getElementById('pigmentBlue').value) || 0) +
                               (parseFloat(document.getElementById('pigmentGreen').value) || 0) +
                               (parseFloat(document.getElementById('pigmentOrange').value) || 0) +
                               (parseFloat(document.getElementById('pigmentBrown').value) || 0);
            
            // Get calculated values from the output
            const cementWeight = parseFloat(document.getElementById('outputCement').textContent.replace(' g', ''));
            const sandWeight = parseFloat(document.getElementById('outputSand').textContent.replace(' g', ''));
            const plasticizerWeight = parseFloat(document.getElementById('outputPlasticizer').textContent.replace(' g', ''));
            const pigmentBlackWeight = parseFloat(document.getElementById('outputPigmentBlack').textContent.replace(' g', ''));
            const pigmentBlueWeight = parseFloat(document.getElementById('outputPigmentBlue').textContent.replace(' g', ''));
            const pigmentGreenWeight = parseFloat(document.getElementById('outputPigmentGreen').textContent.replace(' g', ''));
            const pigmentOrangeWeight = parseFloat(document.getElementById('outputPigmentOrange').textContent.replace(' g', ''));
            const pigmentBrownWeight = parseFloat(document.getElementById('outputPigmentBrown').textContent.replace(' g', ''));
            
            // Fill in the log table
            const dataRows = tbody.getElementsByTagName('tr');
            
            // Set today's date
            dataRows[0].getElementsByTagName('input')[columnIndex].value = new Date().toISOString().split('T')[0];
            
            // Auto-calculate days since cast (will be 0 for today)
            updateDaysSinceCast(dataRows[0].getElementsByTagName('input')[columnIndex], columnIndex + 1);
            
            // Fill Color (predominant pigment)
            dataRows[2].getElementsByTagName('input')[columnIndex].value = getPredominantColor();
            
            // Fill calculated values
            dataRows[3].getElementsByTagName('input')[columnIndex].value = `${ratioPortland}:${ratioSand}`;
            dataRows[4].getElementsByTagName('input')[columnIndex].value = adjustedVolumeInches.toFixed(2);
            dataRows[5].getElementsByTagName('input')[columnIndex].value = pigmentTotal.toFixed(1);
            dataRows[6].getElementsByTagName('input')[columnIndex].value = cementWeight.toFixed(1);
            dataRows[7].getElementsByTagName('input')[columnIndex].value = sandWeight.toFixed(1);
            // Water is manual input - skip row 8
            dataRows[9].getElementsByTagName('input')[columnIndex].value = pigmentBlackWeight.toFixed(1);
            dataRows[10].getElementsByTagName('input')[columnIndex].value = pigmentBlueWeight.toFixed(1);
            dataRows[11].getElementsByTagName('input')[columnIndex].value = pigmentGreenWeight.toFixed(1);
            dataRows[12].getElementsByTagName('input')[columnIndex].value = pigmentOrangeWeight.toFixed(1);
            dataRows[13].getElementsByTagName('input')[columnIndex].value = pigmentBrownWeight.toFixed(1);
            dataRows[14].getElementsByTagName('input')[columnIndex].value = plasticizerWeight.toFixed(1);
            
            // Show success message
            showMessage('success', `Mix data sent to Mix #${columnIndex + 1}!`);
            
            // Scroll to the log table
            document.getElementById('logTable').scrollIntoView({ behavior: 'smooth' });
            
            // Auto-save
            autoSave();
        }
        
        // Save/Load Functions
        function saveData() {
            const data = {
                calculator: getCalculatorData(),
                mixLog: getMixLogData(),
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `concrete-calculator-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showMessage('success', 'Data saved successfully!');
        }
        
        function exportData() {
            const data = {
                calculator: getCalculatorData(),
                mixLog: getMixLogData(),
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `concrete-calculator-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showMessage('success', 'Data exported successfully!');
        }
        
        function exportCSV() {
            const csvData = getMixLogCSV();
            const csvBlob = new Blob([csvData], { type: 'text/csv' });
            const url = URL.createObjectURL(csvBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `mix-log-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            URL.revokeObjectURL(url);
            showMessage('success', 'Mix log exported as CSV!');
        }
        
        function loadData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    setCalculatorData(data.calculator);
                    setMixLogData(data.mixLog);
                    calculate();
                    showMessage('success', 'Data loaded successfully!');
                } catch (error) {
                    showMessage('error', 'Error loading data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                // Reset calculator inputs
                document.getElementById('volume').value = '10';
                document.getElementById('ratioPortland').value = '1';
                document.getElementById('ratioSand').value = '3';
                document.getElementById('waste').value = '10';
                document.getElementById('plasticizerPercent').value = '0.21';
                document.getElementById('plasticizerEnabled').checked = true;
                document.getElementById('pigmentBlack').value = '0';
                document.getElementById('pigmentBlue').value = '0';
                document.getElementById('pigmentGreen').value = '0';
                document.getElementById('pigmentOrange').value = '0';
                document.getElementById('pigmentBrown').value = '0';
                document.getElementById('densityCement').value = '1.1';
                document.getElementById('densitySand').value = '1.72';
                
                // Clear all mix log inputs
                const tbody = document.getElementById('logTable').getElementsByTagName('tbody')[0];
                const inputs = tbody.getElementsByTagName('input');
                const selects = tbody.getElementsByTagName('select');
                
                for (let input of inputs) {
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                }
                
                for (let select of selects) {
                    select.value = '';
                }
                
                togglePlasticizer();
                calculate();
                showMessage('success', 'All data cleared!');
            }
        }
        
        function autoSave() {
            const data = {
                calculator: getCalculatorData(),
                mixLog: getMixLogData(),
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('concreteCalculatorData', JSON.stringify(data));
        }
        
        function autoLoad() {
            const savedData = localStorage.getItem('concreteCalculatorData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    setCalculatorData(data.calculator);
                    setMixLogData(data.mixLog);
                } catch (error) {
                    console.error('Error loading saved data:', error);
                }
            }
        }
        
        function getCalculatorData() {
            return {
                volume: document.getElementById('volume').value,
                ratioPortland: document.getElementById('ratioPortland').value,
                ratioSand: document.getElementById('ratioSand').value,
                waste: document.getElementById('waste').value,
                plasticizerPercent: document.getElementById('plasticizerPercent').value,
                plasticizerEnabled: document.getElementById('plasticizerEnabled').checked,
                pigmentBlack: document.getElementById('pigmentBlack').value,
                pigmentBlue: document.getElementById('pigmentBlue').value,
                pigmentGreen: document.getElementById('pigmentGreen').value,
                pigmentOrange: document.getElementById('pigmentOrange').value,
                pigmentBrown: document.getElementById('pigmentBrown').value,
                densityCement: document.getElementById('densityCement').value,
                densitySand: document.getElementById('densitySand').value
            };
        }
        
        function setCalculatorData(data) {
            if (!data) return;
            document.getElementById('volume').value = data.volume || '10';
            document.getElementById('ratioPortland').value = data.ratioPortland || '1';
            document.getElementById('ratioSand').value = data.ratioSand || '3';
            document.getElementById('waste').value = data.waste || '10';
            document.getElementById('plasticizerPercent').value = data.plasticizerPercent || '0.21';
            document.getElementById('plasticizerEnabled').checked = data.plasticizerEnabled !== false;
            document.getElementById('pigmentBlack').value = data.pigmentBlack || '0';
            document.getElementById('pigmentBlue').value = data.pigmentBlue || '0';
            document.getElementById('pigmentGreen').value = data.pigmentGreen || '0';
            document.getElementById('pigmentOrange').value = data.pigmentOrange || '0';
            document.getElementById('pigmentBrown').value = data.pigmentBrown || '0';
            document.getElementById('densityCement').value = data.densityCement || '1.1';
            document.getElementById('densitySand').value = data.densitySand || '1.72';
            togglePlasticizer();
        }
        
        function getMixLogData() {
            const tbody = document.getElementById('logTable').getElementsByTagName('tbody')[0];
            const rows = tbody.getElementsByTagName('tr');
            const data = [];
            
            for (let i = 0; i < rows.length; i++) {
                const inputs = rows[i].getElementsByTagName('input');
                const selects = rows[i].getElementsByTagName('select');
                const rowData = [];
                
                for (let j = 0; j < inputs.length; j++) {
                    if (inputs[j].type === 'checkbox') {
                        rowData.push(inputs[j].checked);
                    } else {
                        rowData.push(inputs[j].value);
                    }
                }
                
                for (let j = 0; j < selects.length; j++) {
                    rowData.push(selects[j].value);
                }
                
                data.push(rowData);
            }
            return data;
        }
        
        function setMixLogData(data) {
            if (!data || data.length === 0) return;
            
            const tbody = document.getElementById('logTable').getElementsByTagName('tbody')[0];
            const headerRow = document.getElementById('logTable').getElementsByTagName('thead')[0].getElementsByTagName('tr')[0];
            
            // Add columns if needed
            let maxColumns = 0;
            for (let i = 0; i < data.length; i++) {
                if (data[i] && data[i].length > maxColumns) {
                    maxColumns = data[i].length;
                }
            }
            
            while (headerRow.getElementsByTagName('th').length - 1 < maxColumns) {
                addNewColumn();
            }
            
            // Populate data
            const rows = tbody.getElementsByTagName('tr');
            for (let i = 0; i < data.length && i < rows.length; i++) {
                const inputs = rows[i].getElementsByTagName('input');
                const selects = rows[i].getElementsByTagName('select');
                let inputIndex = 0;
                let selectIndex = 0;
                
                for (let j = 0; j < data[i].length; j++) {
                    if (inputIndex < inputs.length) {
                        if (inputs[inputIndex].type === 'checkbox') {
                            inputs[inputIndex].checked = data[i][j] === true || data[i][j] === 'true';
                        } else {
                            inputs[inputIndex].value = data[i][j] || '';
                        }
                        inputIndex++;
                    } else if (selectIndex < selects.length) {
                        selects[selectIndex].value = data[i][j] || '';
                        selectIndex++;
                    }
                }
            }
        }
        
        function getMixLogCSV() {
            const headers = ['Parameter'];
            const parameterNames = [
                'Cast Date', 'Days Since Cast', 'Color', 'Ratio (P:S)', 'Adjusted Volume (in³)', 
                '% Pigment Total', 'Cement (g)', 'Sand (g)', 'Water (g)', 
                'Pigment Black (g)', 'Pigment Blue (g)', 'Pigment Green (g)', 
                'Pigment Orange (g)', 'Pigment Brown (g)', 'Plasticizer (g)',
                'Slurry Coat', 'Mold Release', 'Vibration', 'Mix Notes',
                'Bubble Rating (1-5)', 'Surface Quality', 'Color Evenness', 
                'Sealer Used', 'Final Impressions'
            ];
            
            // Get headers from table
            const headerRow = document.getElementById('logTable').getElementsByTagName('thead')[0].getElementsByTagName('tr')[0];
            const headerCells = headerRow.getElementsByTagName('th');
            for (let i = 1; i < headerCells.length; i++) {
                headers.push(headerCells[i].textContent.replace(/×/g, '').trim());
            }
            
            let csv = headers.join(',') + '\n';
            
            const tbody = document.getElementById('logTable').getElementsByTagName('tbody')[0];
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const inputs = rows[i].getElementsByTagName('input');
                const selects = rows[i].getElementsByTagName('select');
                let rowData = [parameterNames[i] || ''];
                
                for (let j = 0; j < inputs.length; j++) {
                    if (inputs[j].type === 'checkbox') {
                        rowData.push(inputs[j].checked ? 'Yes' : 'No');
                    } else {
                        rowData.push(inputs[j].value || '');
                    }
                }
                
                for (let j = 0; j < selects.length; j++) {
                    rowData.push(selects[j].value || '');
                }
                
                csv += rowData.join(',') + '\n';
            }
            
            return csv;
        }
        
        function showMessage(type, message) {
            const successElement = document.getElementById('successMessage');
            const errorElement = document.getElementById('errorMessage');
            
            // Hide both first
            successElement.style.display = 'none';
            errorElement.style.display = 'none';
            
            if (type === 'success') {
                successElement.textContent = message;
                successElement.style.display = 'block';
                setTimeout(() => successElement.style.display = 'none', 3000);
            } else {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                setTimeout(() => errorElement.style.display = 'none', 5000);
            }
        }
        
        // Google Drive placeholders (simplified for core functionality)
        function initGoogleDrive() {
            showMessage('error', 'Google Drive requires HTTPS hosting. Use local save/load instead.');
        }
        
        function saveToGoogleDrive() {
            showMessage('error', 'Google Drive requires HTTPS hosting.');
        }
        
        function loadFromGoogleDrive() {
            showMessage('error', 'Google Drive requires HTTPS hosting.');
        }
        
        function signOutGoogleDrive() {
            showMessage('error', 'Google Drive requires HTTPS hosting.');
        }
        
        // Initialize calculator on page load
        window.onload = function() {
            autoLoad();
            calculate();
        };
    </script>
</body>
</html>
